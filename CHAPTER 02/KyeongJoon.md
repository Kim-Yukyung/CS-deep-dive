### CPU와 메모리

- CPU는 **Program Counter(PC)** 레지스터에 있는 주소를 기준으로 메모리를 가져옴.
- 레지스터는 용량은 작지만 속도는 아주 빠른 메모리.
- 프로그램의 시작 지점은 `main` 함수.
- 멀티태스킹을 위해 A 작업을 중지하고 B 작업을 실행할 때 **상황 정보(context)** 를 저장함.
    
    → 프론트엔드의 React에서도 Context API로 상태를 저장하는 것과 비슷한 개념.
    

---

### 프로세스와 메모리 구조

- 프로그램은 **프로세스** 형태로 관리됨.
- **운영체제(OS)** 자체가 코드 재사용성의 대표적인 예.
- 프로세스는 다음과 같은 구성으로 되어 있음:
    - 코드 영역
    - 데이터 영역
    - 힙 영역
    - 스택 영역
    - 유휴(남는) 영역
- 다중 프로세스로 두 개의 프로세스를 만들어 값 두 개를 더할 수도 있음.
    
    하지만 리소스 부담 크고 복잡함.
    

---

### 스레드(Thread)

- 프로세스에서 발전된 개념.
- 프로세스 간 통신은 없고, 같은 주소 공간을 공유함 (경량 프로세스).
- 모든 함수는 실행 시 자신만의 **스택 프레임**을 가짐 (LIFO 구조).

---

### 수명주기 관점

- **긴 작업** → 긴 수명 스레드 생성
- **짧은 작업** → 스레드 풀(Thread Pool) 사용
    - 미리 여러 스레드가 생성되어 있고, 작업 시 빠르게 재사용.

---

### 리소스 관점

- CPU 집약적 / 입출력(I/O) 집약적 작업 존재.
- 입출력 대기시간과 연산 시간이 같다면 스레드는 2배 정도 있어야 리소스가 최대 활용됨 (이론상).

---

### 스레드 간 리소스 공유

- 프로세스 주소 공간 중 **스택을 제외한 모든 영역 공유**
- 코드 영역 → 기계 명령어 저장
- 데이터 영역 → 전역 변수 저장
- 힙 영역 → 포인터 중심, 스레드 간 공유 가능
- 스택 영역 → 스레드 전용
    - 하지만 다른 스레드의 포인터로 접근 가능하면 버그 발생 가능

---

### 스레드 전용 저장소

- 모든 스레드에서 접근은 가능하지만, 각각 독립된 값 유지.
- 즉, 한 스레드가 변수 바꿔도 다른 스레드에는 영향 없음.

---

### 스레드 안전(Thread Safety)

- 함수 지역 변수, 스택 영역, 스레드 전용 저장소 → 스레드 전용 리소스 (집에 있는 물건처럼)
- 그 외 공유 리소스 → 공공장소 리소스

> 공공장소에서는 “새치기 금지” — 순서 지켜야 함
> 
- 지역 변수만 사용하는 함수 → **무상태 함수 (Stateless Function)**
    
    → 스레드 안전.
    
- 포인터 사용 시 힙 영역 접근 = 공공장소에서 빌려 쓰는 것
    
    → 전역 변수는 잠금(lock) 또는 원자적 연산(atomic)으로 제어해야 안전.
    
- 두 스레드가 같은 힙 변수를 가리키면 스레드 안전 아님.
    
    → 하지만 semaphore나 lock 사용 시 안전함.
    

---

### 코루틴(Coroutine)

- 운영체제 의존 없이 스레드 비슷하게 동작.
- 자기 실행 상태를 저장하고, 중단된 지점에서 재개 가능.

---

### 동기 / 비동기

- 동기는 하나 끝나야 다음 작업 가능 (멀티 불가)
- 비동기는 여러 작업을 동시에 처리 가능.
- 비동기 콜백 등장 → 콜백지옥 시작.

> “30분 기다리지 않게 비동기가 생겼다”는 비유 아주 좋음 👍
> 
- **블로킹**: 스레드나 프로세스가 일시 중단된 상태.
- **논블로킹**: 비동기 입출력.
    - 배달의 민족 배달 = 논블로킹
    - 방문 포장 = 블로킹

---

### 다중 프로세스 vs 다중 스레드

- **다중 프로세스**
    - 장점: 서로 독립적
    - 단점: 통신 어려움, 생성 비용 큼
- **다중 스레드**
    - 단점: 하나 망가지면 다 영향
    - 그래도 프로세스보다 효율적

---

### 기타 개념

- 유닉스는 “모든 것이 파일이다”라는 철학
- 단일 스레드로 느릴 때 다중 스레드로 확장
- 역할을 나눠 처리하는 구조는 **반응자 패턴(Reactor Pattern)**

---

### 계층 구조와 언어

- CPU, 스레드, 코루틴은 서로 다른 계층에 존재.
- C언어는 일급 객체가 아니라 함수 반환 불가.
- 파이썬은 가능.

---

### 가상화

- 컨테이너 위에 하드웨어 리소스를 띄워 사용하는 게 **하이퍼바이저(Hypervisor)**.
- 실제 물리 하드웨어를 가상화해 여러 시스템이 동시에 돌게 함.
